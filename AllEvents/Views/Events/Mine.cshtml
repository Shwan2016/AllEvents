@model IEnumerable<AllEvents.Models.Event>
@{
    ViewBag.Title = "Mine";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>My Upcaming Events</h2>

<ul class="events">
    @foreach (var events in Model)
    {
        <li>
            <div class="date">
                <div class="weekdays">
                    @events.DateTime.ToString("dddd")
                </div>
                <div class="day">
                    @events.DateTime.ToString("d ")
                </div>
            </div>
            <div class="details">
                <span class="creator">
                    @events.Location
                </span>
                <span class="eventType">
                    @events.EventType.Name
                </span>
                <div class="actions">
                    <a href="@Url.Action("Edit", "Events", new {id = events.Id})">
                        Edit 
                    </a> |
                    <a href="#" class="js-cancel-event" data-event-id="@events.Id">
                        Cancel
                    </a> 
                </div>
            </div>
        </li>
    }

</ul>
@section scripts
{
    <script>
        $(document)
            .ready(function() {
                $(".js-cancel-event")
                    .click(function(e) {
                        var link = $(e.target);

                        bootbox.confirm({
                            message: "Are you sure you want to delete this event?",
                            buttons: {
                                confirm: {
                                    label: 'Yes',
                                    className: 'btn-default'
                                },
                                cancel: {
                                    label: 'No',
                                    className: 'btn-danger'
                                }
                            },

                            callback: function(answer) {
                                if(answer === true)
                                $.ajax({
                                        url: "/api/events/" + link.attr("data-event-id"),
                                        method: "DELETE"
                                    })
                                    .done(function() {
                                        link.parents("li")
                                            .fadeOut(function() {
                                                $(this).remove();
                                            });
                                        
                                    })
                                    .fail(function() {
                                        alert("It was not able to delete it");
                                    });
                            }
                    });
                    });
            })
    </script>
}

